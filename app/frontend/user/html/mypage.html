<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <title>내정보</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- 공통 / 전용 CSS -->
  <link rel="stylesheet" href="/static/user/css/style.css"/>
  <link rel="stylesheet" href="/static/user/css/mypage.css"/>
</head>
<body>
  <input type="hidden" id="no_seq" name="no_seq" value="{{ data.no_seq }}">

  <!-- 헤더 -->
  <header class="site-header">
    <div class="brand"><h1>내정보</h1><p class="subtitle">We don't wanna you</p></div>
    <div class="auth-area"><button class="btn ghost" onclick="location.href='/'">← 메인</button></div>
  </header>

  <div class="container mypage-container">
    <!-- 탭바 (카드 위 중앙) -->
    <div class="tabbar-wrap">
      <div class="tabbar" role="tablist" aria-label="내정보 탭">
        <button class="tab-pill active" data-tab="profile" role="tab" aria-selected="true" aria-controls="panel-profile">내정보</button>
        <button class="tab-pill" data-tab="password" role="tab" aria-selected="false" aria-controls="panel-password">비밀번호 변경</button>
      </div>
    </div>

    <!-- 카드 -->
    <section class="page-card mypage-card">
      <!-- 내정보 패널 -->
      <div id="panel-profile" class="tab-panel active" role="tabpanel" aria-labelledby="tab-profile">
        <div class="card-header">
          <div>
            <div class="card-title">내정보</div>
            <div class="card-sub">가입 시 입력한 정보를 수정할 수 있어요</div>
          </div>
          <span class="badge">PROFILE</span>
        </div>
        <div class="divider"></div>

        <form id="formData" name="formData">
          <input type="hidden" id="user_id" name="user_id" value="{{ data.user_id }}">
          <div class="form">
            <div class="grid-2">
              <!-- ✅ 아이디: 입력창 없이 텍스트로만 표시 -->
              <div class="field">
                <label>아이디</label>
                <div id="userid_view" class="userid-view" aria-live="polite">{{ data.user_id }}</div>
              </div>
              <div class="field">
                <label for="user_email">이메일</label>
                <input id="user_email" name="user_email" type="email" placeholder="you@example.com" value="{{ data.user_email }}"/>
              </div>
            </div>

            <div class="grid-2">
              <div class="field">
                <label for="user_addr1">주소1</label>
                <div class="with-btn">
                  <input id="user_addr1" name="user_addr1" readonly placeholder="도로명 주소" value="{{ data.user_addr1 }}" />
                  <button type="button" class="btn soft" id="btnFindAddrMy">주소 검색</button>
                </div>
              </div>
              <div class="field">
                <label for="user_addr2">주소2</label>
                <input id="user_addr2" name="user_addr2" placeholder="상세 주소(동/호수 등)" value="{{ data.user_addr2 }}"/>
              </div>
            </div>

            <div class="grid-2">
              <div class="field">
                <label for="user_post">우편번호</label>
                <input id="user_post" name="user_post" inputmode="numeric" pattern="[0-9]{5}" maxlength="5" readonly placeholder="5자리" value="{{ data.user_post }}" />
              </div>
              <div class="field">
                <label for="user_birth">생년월일</label>
                <input id="user_birth" name="user_birth" type="date" placeholder="YYYY-MM-DD" value="{{ data.user_birth }}" />
              </div>
            </div>
          </div>

          <div class="actions">
            <button class="btn primary gradient block" type="submit" id="saveProfile">내 정보 수정</button>
          </div>
        </form>
        
        <form id="deactivateFormData" name="deactivateFormData">
          <!-- 회원탈퇴(비활성화): 눈에 띄지 않게 회색 텍스트 -->
          <div class="deactivate-row">
            <span id="deactivateLink" class="muted-link">회원탈퇴(비활성화)</span>
          </div>
        </form>
      </div>

      <!-- 비밀번호 변경 패널 -->
      <div id="panel-password" class="tab-panel" role="tabpanel" aria-labelledby="tab-password" hidden>
        <div class="card-header">
          <div>
            <div class="card-title">비밀번호 변경</div>
            <div class="card-sub">안전한 비밀번호로 주기적 변경을 권장합니다</div>
          </div>
          <span class="badge">PASSWORD</span>
        </div>
        <div class="divider"></div>

        <form id="pwFormData" name="pwFormData">
          <div class="grid-2">
            <div class="field">
              <label for="now_user_pw">현재 비밀번호</label>
              <input id="now_user_pw" name="now_user_pw" type="password"/>
            </div>
            <div class="field">
              <label for="new_user_pw">새 비밀번호</label>
              <input id="new_user_pw" name="new_user_pw" type="password"/>
            </div>
          </div>
          
          <div class="actions">
            <button class="btn primary gradient block" type="submit" id="changePw">변경</button>
          </div>
        </form>
      </div>
    </section>

    <!-- 주소 레이어(카드 내장) -->
    <div id="postcodeLayerMy" class="addr-layer" role="dialog" aria-modal="true" aria-label="도로명 주소 검색">
      <div class="addr-layer-header">
        <span class="addr-layer-title">도로명 주소 검색</span>
        <button type="button" class="addr-layer-close" aria-label="닫기">닫기 ✕</button>
      </div>
      <div class="addr-layer-body"></div>
    </div>
  </div>

  <!-- ✅ 마스코트: 파일은 그대로, 배치는 CSS에서 조정 -->
  <aside class="mascot-side"><img src="/static/user/image/mascot.png" alt="마스코트"/></aside>
  <aside class="mascot-sub"><img src="/static/user/image/mascot_sub.png" alt="서브 마스코트" /></aside>
  
  <!-- JS -->
  <script src="/static/user/js/mypage.js"></script>
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <script type="module">
    import { bindPostcodeLayer } from "/static/user/js/addr.js";
    bindPostcodeLayer({ buttonId:'btnFindAddrMy', layerId:'postcodeLayerMy', addrId:'user_addr1', postId:'user_post' });

    // 탭 토글
    const pills = document.querySelectorAll('.tab-pill');
    const panels = { profile: document.getElementById('panel-profile'), password: document.getElementById('panel-password') };
    pills.forEach(b=>{
      b.addEventListener('click', ()=>{
        pills.forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        const to = b.dataset.tab;
        Object.values(panels).forEach(p=>{ p.classList.remove('active'); p.hidden = true; });
        panels[to].classList.add('active'); panels[to].hidden = false;
      });
    });
  </script>
</body>
</html>
